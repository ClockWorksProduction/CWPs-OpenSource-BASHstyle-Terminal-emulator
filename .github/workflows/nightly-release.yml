name: Nightly Release

on:
  schedule:
    - cron: '0 3 1,15 * *' # Runs at 03:00 UTC on the 1st and 15th of every month
  workflow_dispatch: # Allows manual triggering

jobs:
  publish-nightly:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'
          registry-url: 'https://registry.npmjs.org/'

      - name: Get Current Date
        id: date
        run: echo "::set-output name=date::$(date +'%Y%m%d')"

      - name: Update Version
        run: |
          CURRENT_VERSION=$(node -p "require('./package.json').version")
          NEW_VERSION="$CURRENT_VERSION-nightly.${{ steps.date.outputs.date }}"
          npm version $NEW_VERSION --no-git-tag-version

      - name: Install Dependencies
        run: npm install

      - name: Publish to npm
        run: npm publish --tag nightly
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
