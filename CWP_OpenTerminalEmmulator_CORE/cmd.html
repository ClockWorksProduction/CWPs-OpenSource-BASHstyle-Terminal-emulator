<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Terminal Emulator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/cmd.css">
</head>
<body>
    <div id="pseudo-terminal">
        <div id="terminalOutput"></div>
        <div id="terminal-input-container">
            <span id="terminal-prompt">$</span>
            <input type="text" id="terminal-command-input" autocomplete="off" autofocus>
        </div>
    </div>

    <script type="module">
        import { Terminal, TerminalLib, VirtualOS, AddonExecutor } from './js/centralTerminal.js';
        import { populateFileSystem } from './js/filesystem_addon.js';

        // --- Initialization ---
        const outputDiv = document.getElementById('terminalOutput');
        const inputElement = document.getElementById('terminal-command-input');
        
        const term = new Terminal('main', outputDiv);
        const vOS = new VirtualOS();
        const addonExecutor = new AddonExecutor();
        const termLib = new TerminalLib(term, vOS, addonExecutor);

        // Populate the file system
        populateFileSystem(vOS);

        // --- Event Listener ---
        inputElement.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                const commandText = inputElement.value.trim();
                if (commandText) {
                    term.print(`$ ${commandText}`);
                    termLib.runCommand(commandText);
                    inputElement.value = "";
                }
            }
        });

        // --- Initial Welcome Message ---
        term.print("Welcome to the CWP Terminal Emulator.");
        term.print("Type 'help' for a list of commands.");

        inputElement.focus();
        document.body.addEventListener('click', () => inputElement.focus());